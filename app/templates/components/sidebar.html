{% macro sidebar(nugget_alias) %}
<div class="sidebar">    
    <div class="sidebar-header">
        <button id="sidebar-toggle" class="sidebar-toggle">
            <i class="fas fa-bars"></i>
        </button>
        <a href="/dashboard/home" class="sidebar-logo" id="sidebar-icon">
            <i class="fas fa-robot"></i>
            <span class="logo-text">Nugget Tech</span>
        </a>
    </div>

    <nav class="nav-section">
        <div class="nav-section-title">Main</div>
        <ul class="nav-items">
            <li class="nav-item">
                <a href="/dashboard/{{nugget_alias}}/dashboard" class="nav-link {% if active_page == 'dashboard' %}active{% endif %}">
                    <i class="fas fa-home nav-link-icon"></i>
                    <span class="nav-link-text">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/api/invite/{{nugget_alias}}" class="nav-link">
                    <i class="fas fa-link nav-link-icon"></i>
                    <span class="nav-link-text">Invite</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Authentication & API Keys -->
    <nav class="nav-section">
        <div class="nav-section-title">Authentication</div>
        <ul class="nav-items">
            <li class="nav-item">                
                <a href="/dashboard/{{ nugget_alias }}/api-keys" class="nav-link {% if active_page == 'api-keys' %}active{% endif %}">
                    <i class="fas fa-key nav-link-icon"></i>
                    <span class="nav-link-text">API Keys</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- AI Settings -->
    <nav class="nav-section">
        <div class="nav-section-title">AI Configuration</div>
        <ul class="nav-items">
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/ai/model" class="nav-link {% if active_page == 'ai-model' %}active{% endif %}">
                    <i class="fas fa-microchip nav-link-icon"></i>
                    <span class="nav-link-text">Model Settings</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/ai/filters" class="nav-link {% if active_page == 'ai-filters' %}active{% endif %}">
                    <i class="fas fa-shield-alt nav-link-icon"></i>
                    <span class="nav-link-text">Content Filters</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/ai/generation" class="nav-link {% if active_page == 'ai-generation' %}active{% endif %}">
                    <i class="fas fa-cog nav-link-icon"></i>
                    <span class="nav-link-text">Generation Config</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/ai/messages" class="nav-link {% if active_page == 'ai-messages' %}active{% endif %}">
                    <i class="fas fa-comment-alt nav-link-icon"></i>
                    <span class="nav-link-text">Messages</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Personality & Prompting -->
    <nav class="nav-section">
        <div class="nav-section-title">Personality</div>
        <ul class="nav-items">
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/personality/traits" class="nav-link {% if active_page == 'personality-traits' %}active{% endif %}">
                    <i class="fas fa-user-circle nav-link-icon"></i>
                    <span class="nav-link-text">Personality Traits</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/personality/prompting" class="nav-link {% if active_page == 'personality-prompting' %}active{% endif %}">
                    <i class="fas fa-comment-dots nav-link-icon"></i>
                    <span class="nav-link-text">System & Examples</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/personality/autonomy" class="nav-link {% if active_page == 'personality-autonomy' %}active{% endif %}">
                    <i class="fas fa-brain nav-link-icon"></i>
                    <span class="nav-link-text">Autonomy</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Features -->
    <nav class="nav-section">
        <div class="nav-section-title">Features</div>
        <ul class="nav-items">
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/features/voice" class="nav-link {% if active_page == 'voice' %}active{% endif %}">
                    <i class="fas fa-microphone nav-link-icon"></i>
                    <span class="nav-link-text">Voice</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/features/memory" class="nav-link {% if active_page == 'memories' %}active{% endif %}">
                    <i class="fas fa-memory nav-link-icon"></i>
                    <span class="nav-link-text">Memories</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Knowledge -->
    <nav class="nav-section">
        <div class="nav-section-title">Knowledge</div>
        <ul class="nav-items">
            <li class="nav-item">
                <a href="/dashboard/{{ nugget_alias }}/knowledge" class="nav-link {% if active_page == 'knowledge' %}active{% endif %}">
                    <i class="fas fa-book nav-link-icon"></i>
                    <span class="nav-link-text">Knowledge Base</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- User -->
    <nav class="nav-section">
        <div class="nav-section-title">User</div>
        <ul class="nav-items">
            <li class="nav-item">
                <a href="/dashboard/user/profile" class="nav-link {% if active_page == 'profile' %}active{% endif %}">
                    <i class="fas fa-user nav-link-icon"></i>
                    <span class="nav-link-text">Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/auth/logout" class="nav-link">
                    <i class="fas fa-sign-out-alt nav-link-icon"></i>
                    <span class="nav-link-text">Logout</span>
                </a>
            </li>
        </ul>
    </nav>
</div>


<style>
.sidebar {
    transition: width 0.3s ease;
}

.sidebar.collapsed {
    width: 60px;
}

.sidebar.collapsed .nav-section-title,
.sidebar.collapsed .nav-link-text,
.sidebar.collapsed .logo-text {
    display: none;
}

.sidebar-toggle {
    background: none;
    border: none;
    color: #FFFFFF;
    cursor: pointer;
    padding: 15px;
    margin-right: 8px;
    border-radius: 8px;
    transition: background-color 0.2s ease;
}

.sidebar-toggle:hover {
    background: rgba(255, 255, 255, 0.1);
}

.sidebar-header {
    padding: 15px !important; 
    border-bottom: 1px solid var(--border-color);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const sidebar = document.querySelector('.sidebar');
    const icon = document.getElementsByClassName("fas fa-robot");
    const navbarLength = document.getElementsByClassName("top-nav");
    const username = document.getElementsByClassName("username");
    const mainContent = document.querySelector('.main-content');

    const sidebarToggle = document.getElementById('sidebar-toggle');


    // Check if there's a saved state
    const isSidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isSidebarCollapsed) {
        sidebar.classList.add('collapsed');
        if (icon.length > 0) {
            icon[0].style.display = "none";
        }
    
    }

    if (isSidebarCollapsed) {
        mainContent.style.marginLeft = '0px';
        navbarLength[0].style.position = 'static';
        username[0].style.display = 'none';
    }


    sidebarToggle.addEventListener('click', function () {
        sidebar.classList.toggle('collapsed');
        const isCollapsed = sidebar.classList.contains('collapsed');

        // Save the state
        localStorage.setItem('sidebarCollapsed', isCollapsed);

        if (icon.length > 0) {
            icon[0].style.display = isCollapsed ? "none" : "inline-block"; // or "block"
        }

        if (isCollapsed) {
            mainContent.style.marginLeft = '0px';
            navbarLength[0].style.position = 'static';
            username[0].style.display = 'none';
        }
        else {
            mainContent.style.marginLeft = '250px';
            navbarLength[0].style.position = 'fixed';
            username[0].style.display = '';
        }

    });
});
</script>
{% endmacro %}
